<script type="text/javascript" src="/AJAX/jquery-3.5.1.min.js"></script>

<form id="filter" method="POST" action="#">
    <div style="float: left; margin-right: 10px;" onselect="ajax()">
        <select name="bookmaker" id="bookmaker">
            <option value="888sport">888sport</option>
            <option value="Betrebels">Betrebels</option>
            <option value="Betsafe">Betsafe</option>
            <option value="Betsson">Betsson</option>
            <option value="Casinowinner">Casinowinner</option>
            <option value="Neobet">Neobet</option>
            <option value="Spinsports" selected="selected">Spinsports</option>
        </select>
    </div>
    <div class="wrapper" style="display: inline-block;">
        <div class="" style="float: left; margin-right: 5px;">
            <input type="range" name="time_range" id="time_range" min="0" max="25" value="25">
            <p>Game before: <span id="output"></span></p>
        </div>
        <div class="" style="float: left; margin-right: 5px;">
            <input type="range" name="min_odds" id="min_odds" min="0" max="30" value="0">
            <p>Minimum odds: <span id="min_odds_output"></span></p>
        </div>
        <div class="" style="float: left;">
            <input type="range" name="max_odds" id="max_odds" min="0" max="30" value="30">
            <p>Maximum odds: <span id="max_odds_output"></span></p>
        </div>
        <div class="" style="float: left;">
            <input type="range" name="min_liquidity" id="min_liquidity" min="0" max="1000" step="10" value="0">
            <p>Minimum Liquidity: <span id="min_liquidity_output"></span></p>
        </div>
        <div style="display:block; text-align: center;">
            <input type="submit" value="Submit">
        </div>
    </div>
    
</form>



<script>
var slider = document.getElementById("time_range");
var output = document.getElementById("output");

var min_odds_slider = document.getElementById("min_odds");
var min_odds_output = document.getElementById("min_odds_output");

var max_odds_slider = document.getElementById("max_odds");
var max_odds_output = document.getElementById("max_odds_output");

var min_liquidity_slider = document.getElementById("min_liquidity");
var min_liquidity_output = document.getElementById("min_liquidity_output");

//Time
output.innerHTML = "∞";
slider.oninput = function() {
    if (slider.value < 25) {
        output.innerHTML = this.value + ":00";
    } else {
        output.innerHTML = "∞";
    }
    
}

//Min odds
min_odds_output.innerHTML = min_odds_slider.value;
min_odds_slider.oninput = function() {
    min_odds_output.innerHTML = min_odds_slider.value;
}

//Max odds
max_odds_output.innerHTML = max_odds_slider.value;
max_odds_slider.oninput = function() {
    max_odds_output.innerHTML = this.value;
}

//Min Liquidity
min_liquidity_output.innerHTML = "€" + min_liquidity_slider.value;
min_liquidity_slider.oninput = function() {
    min_liquidity_output.innerHTML = "€" + this.value;
}


</script>

<style>
#oddsmatcher {table-layout: fixed;}
#oddsmatcher td, #oddsmatcher th {border: 1px solid #ddd; padding: 5px; white-space: nowrap; text-overflow:ellipsis; overflow: hidden; max-width:1px;}
#oddsmatcher tr:nth-child(2n+2){background-color: #f2f2f2;}
#oddsmatcher tr:hover {background-color: #ddd;}
#oddsmatcher th {padding-top: 12px;padding-bottom: 12px;text-align: left;background-color: #5C9EAD;color: white;}
.match {width: 35%;}
.result {width: 20%;}
.bookmaker {width: 10%; border-right: 1px solid #f2f2f2;}
.exchange {width: 10%;}
#oddsmatcher tbody tr td:nth-child(3) {background-color:#a6d8ff;}
#oddsmatcher tbody tr td:nth-child(4) {background-color:#fac9d1;}
.liquidity {width: 10%;}
.date {width: 15%;}
</style>
    

<table id="oddsmatcher" border='1'>
    <colgroup>
        <col class="match" />
        <col class="result" />
        <col class="bookmaker" />
        <col class="exchange" />
        <col class="liquidity" />
        <col class="date" />
    </colgroup>
    <tr>
        <th>Match</th>
        <th>Result</th>
        <th>Back</th>
        <th>Lay</th>
        <th>Liquidity</th>
        <th>Date</th>
    </tr>
</table>

<script>
    function RefreshTable() {
        //console.log("Refresh!");
        jQuery("#oddsmatcher > tbody > tr:not(:first)").remove()
   }

    var ajax = function() {
        jQuery.ajax({    //create an ajax request to display.php
            type: "POST",
            url: "/AJAX/ajax_php_call.php",             
            data: jQuery('#filter').serialize(),
            dataType: "json",   //expect json to be returned                
            success: function(response){        
                RefreshTable();
                jQuery.each(response, function(i, item) {
                    $game = jQuery(item)[0]["MatchName"];
                    $bookmaker_odds = jQuery(item)[0]["BookmakerOdds"];
                    $exchange_odds = jQuery(item)[0]["ExchangeOdds"];
                    $liquidity = jQuery(item)[0]["Liquidity"];
                    $result = jQuery(item)[0][7];
                    $date = jQuery(item)[0]["Date"];
                    $time = jQuery(item)[0]["Time"];
                    //console.log((item));
                    jQuery('#oddsmatcher > tbody:last-child').append(`<tr><td>${$game}</td><td>${$result}</td><td>${$bookmaker_odds}</td><td>${$exchange_odds}</td><td>${$liquidity}</td><td>${$date} ${$time}</td></tr>`);
                });
            }
        });
    }

    jQuery(document).ready(ajax);
    jQuery("#filter").submit(function(e) {
        e.preventDefault();
        console.log("Preventing default!!!");
        ajax();
    });    
    jQuery("#bookmaker").on("change", function() {
        ajax();
    });


setInterval(ajax, 1000*60* 2);
</script>